{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://multi-agent-ide/schemas/consolidation-template.json",
  "title": "ConsolidationTemplate",
  "description": "Standardized output structure for collector agents",
  "type": "object",
  "properties": {
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of this schema"
    },
    "resultId": {
      "$ref": "context-id.json",
      "description": "ID of this consolidation result"
    },
    "inputs": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/InputReference"
      },
      "description": "References to inputs consolidated"
    },
    "mergeStrategy": {
      "type": "string",
      "minLength": 1,
      "description": "Strategy used to merge inputs"
    },
    "conflictResolutions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/ConflictResolution"
      },
      "description": "How conflicts were resolved"
    },
    "aggregatedMetrics": {
      "type": "object",
      "additionalProperties": {
        "type": "number"
      },
      "description": "Aggregated metrics from inputs"
    },
    "consolidatedOutput": {
      "type": "string",
      "minLength": 1,
      "description": "The merged/consolidated output"
    },
    "decision": {
      "$ref": "#/$defs/CollectorDecision",
      "description": "Phase advancement decision"
    },
    "upstreamContextChain": {
      "type": "array",
      "items": {
        "$ref": "context-id.json"
      },
      "description": "Full upstream context chain for traceability"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "description": "Training metadata"
    }
  },
  "required": [
    "schemaVersion",
    "resultId",
    "inputs",
    "mergeStrategy",
    "consolidatedOutput",
    "decision",
    "upstreamContextChain",
    "metadata"
  ],
  "$defs": {
    "InputReference": {
      "type": "object",
      "properties": {
        "inputContextId": {
          "$ref": "context-id.json"
        },
        "inputType": {
          "type": "string",
          "minLength": 1
        },
        "inputSummary": {
          "type": "string",
          "minLength": 1
        }
      },
      "required": ["inputContextId", "inputType", "inputSummary"]
    },
    "ConflictResolution": {
      "type": "object",
      "properties": {
        "conflictDescription": {
          "type": "string",
          "minLength": 1
        },
        "resolutionApproach": {
          "type": "string",
          "minLength": 1
        },
        "conflictingInputs": {
          "type": "array",
          "minItems": 2,
          "items": {
            "$ref": "context-id.json"
          }
        }
      },
      "required": ["conflictDescription", "resolutionApproach", "conflictingInputs"]
    },
    "CollectorDecision": {
      "type": "object",
      "properties": {
        "decisionType": {
          "type": "string",
          "enum": ["ROUTE_BACK", "ADVANCE_PHASE", "STOP"]
        },
        "rationale": {
          "type": "string",
          "minLength": 1
        },
        "requestedPhase": {
          "type": ["string", "null"]
        }
      },
      "required": ["decisionType", "rationale"]
    }
  }
}
